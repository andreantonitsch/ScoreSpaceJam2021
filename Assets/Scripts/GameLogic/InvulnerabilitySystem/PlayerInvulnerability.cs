using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerInvulnerability : MonoBehaviour
{
    public Material player_material;
    public Collider2D player_collider;
    public ArcadeMovement mp;
    public HP hp;
    public float InvicibilityDuration = 0.2f;

    public float timer = 0;



    public IEnumerator TimedInvincibility()
    {
         while(timer > 0.0f)
        {
            yield return new WaitForSeconds(0.05f);
        }
        player_material.SetFloat("_Flashing", 0.0f);
        player_collider.enabled = true;

    }

    public void MakePlayerInvulnerable()
    {
        if (timer > 0) return;
        player_material.SetFloat("_Flashing", 1/0.05f);
        player_collider.enabled = false;
        timer = InvicibilityDuration;
        StartCoroutine(TimedInvincibility());
    }

    public void MakePlayerInvulnerable(int quant) { MakePlayerInvulnerable(); }


    public void Start()
    {
        player_collider = GetComponent<Collider2D>();
        mp = GetComponent<ArcadeMovement>();
        hp =   GetComponent<HP>();
       
        mp.TeleportTriggeredEvent += MakePlayerInvulnerable;
        hp.HPChangedEvent += MakePlayerInvulnerable;

    }

    public void FixedUpdate()
    {
        timer -= ScaledTime.fixedDeltaTime;
    }
}
